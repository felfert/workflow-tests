name: UT for check-versions workflow

# See https://docs.github.com/en/actions/using-workflows/reusing-workflows#using-a-matrix-strategy-with-a-reusable-workflow

on:
  workflow_dispatch:

jobs:

  test:
    name: ${{ matrix.job.name }}
    outputs:
      expectedsuccess: ${{ matrix.job.expectsuccess }}
      actualsatus: ${{ matrix.job.status }}
      name: ${{ matrix.job.name }}
    uses: ./.github/workflows/check-versions.yml 
    with:
      refname: ${{ matrix.job.refname }}
      reftype: ${{ matrix.job.reftype }}
      tomls: ${{ matrix.job.tomls }}
    strategy:
      fail-fast: false
      matrix:
        job:
          - name: Normal tag
            refname: '0.2.4'
            reftype: 'tag'
            tomls: '["Cargo.toml", "cherryrgb/Cargo.toml"]'
            expectsuccess: true
          - name: Wrong version in toml
            refname: '0.2.4'
            reftype: 'tag'
            tomls: '["Cargo-wrongversion.toml", "cherryrgb/Cargo.toml"]'
            expectsuccess: false
          - name: Nonexistant toml
            refname: '0.2.4'
            reftype: 'tag'
            tomls: '["nonexistent.toml", "cherryrgb/Cargo.toml"]'
            expectsuccess: false
          - name: Invalid JSON
            refname: '0.2.4'
            reftype: 'tag'
            tomls: 'invalidJSON'
            expectsuccess: false
          - name: Empty tomls
            refname: '0.2.4'
            reftype: 'tag'
            tomls: '[]'
            expectsuccess: true

  main:
    needs: [test]
    if: always() && !cancelled()
    runs-on: ubuntu-latest
    steps:
      - run: echo "${{ toJSON(needs.test) }}"
